// Arrow v1.2.0 | Copyright (c) 2013-2014 Daniele Veneroni | Licensed under GPLv3 License
"use strict";var paper=new Palette("pad");var presetSelect=$$("#presetSelect");var waveSelect=$$("#waveSelect"),oscDetuneLabel=$$("#oscDetuneLabel"),oscDetuneRange=$$("#oscDetuneRange");var filterSelect=$$("#filterSelect"),filterFrequencyLabel=$$("#filterFrequencyLabel"),filterFrequencyRange=$$("#filterFrequencyRange"),filterQualityLabel=$$("#filterQualityLabel"),filterQualityRange=$$("#filterQualityRange"),filterGainLabel=$$("#filterGainLabel"),filterGainRange=$$("#filterGainRange");var delayTimeLabel=$$("#delayTimeLabel"),delayTimeRange=$$("#delayTimeRange"),delayFeedbackLabel=$$("#delayFeedbackLabel"),delayFeedbackRange=$$("#delayFeedbackRange");var spectrumColor1=$$("#spectrumColor1"),spectrumColor2=$$("#spectrumColor2"),spectrumSize=$$("#spectrumSize");var util={};function adaptScreen(){util.docHeight=Math.max(document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);util.docWidth=Math.max(document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clientWidth,document.documentElement.clientWidth);util.maxSpectrumHeight=util.docHeight/4*3;paper.size(util.docWidth,util.docHeight);paper.gradient(0,0,util.docWidth,0,spectrumColor1.val(),spectrumColor2.val());}adaptScreen();$$(window).on("resize",adaptScreen);if(localStorage.getItem("userPresets")===null){localStorage.userPresets=JSON.stringify({presets:[]});}var presets=[];function loadPresets(){presets=factoryPresets.concat(JSON.parse(localStorage.userPresets).presets);var b="";for(var a=0;a<presets.length;a++){b+='<option value="'+a+'">'+presets[a].name+"</option>";console.log(JSON.stringify(presets[a]));}presetSelect.html(b);}loadPresets();function drawSpectrum(d){paper.clear(0,0,util.docWidth,util.docHeight);var c=util.docWidth/(d.length*2);for(var a=0;a<(d.length);a++){var b=util.docHeight-(util.maxSpectrumHeight*d[a]/256);paper.rect(a*(c*2),b,c,util.docHeight);}}$$("#menuBtn").on("click",function(){$$("#menu").show();$$("#menuBtn").hide();});$$("#helpBtn").on("click",function(){$$("#help").show();});$$("#closeBtn").on("click",function(){$$("#menu").hide();$$("#menuBtn").show();});$$("#helpCloseBtn").on("click",function(){$$("#help").hide();});var osccollapsible=document.getElementById("osc-collapsible");var filtercollapsible=document.getElementById("filter-collapsible");var delaycollapsible=document.getElementById("delay-collapsible");var optionscollapsible=document.getElementById("options-collapsible");$$("#osc-title").on("click",function(){osccollapsible.hidden=!osccollapsible.hidden;});$$("#filter-title").on("click",function(){filtercollapsible.hidden=!filtercollapsible.hidden;});$$("#delay-title").on("click",function(){delaycollapsible.hidden=!delaycollapsible.hidden;});$$("#options-title").on("click",function(){optionscollapsible.hidden=!optionscollapsible.hidden;});function configurePreset(b){nodes.touchOSC.type=b.osc.wave;nodes.touchOSC.detune.value=b.osc.detune;for(var a=0;a<keyNodes.length;a++){keyNodes[a].type=b.osc.wave;keyNodes[a].detune.value=b.osc.detune;}nodes.filter.type=b.filter.type;nodes.filter.frequency.value=b.filter.frequency;nodes.filter.Q.value=b.filter.quality;nodes.filter.gain.value=b.filter.gain;nodes.delay.delayTime.value=b.delay.delayTime;nodes.feedback.gain.value=b.delay.feedback;waveSelect.val(b.osc.wave);oscDetuneRange.val(b.osc.detune);oscDetuneLabel.text(""+b.osc.detune);filterSelect.val(b.filter.type);filterFrequencyLabel.text(b.filter.frequency.toFixed(2)+"Hz");filterQualityRange.val(b.filter.quality/30);filterQualityLabel.text(b.filter.quality.toFixed(2));filterGainRange.val(b.filter.gain);filterGainLabel.text(""+b.filter.gain);delayTimeRange.val(b.delay.delayTime/1*100);delayTimeLabel.text(Math.round(b.delay.delayTime*1000)+"ms");delayFeedbackLabel.text(""+Math.round(b.delay.feedback*100));}presetSelect.on("change",function(){configurePreset(presets[presetSelect.val()]);});$$("#saveBtn").on("click",function(){var a=window.prompt("Preset Name: ");if(a&&a!==""){var b={name:a,osc:{wave:waveSelect.val(),detune:oscDetuneRange.val()},filter:{type:filterSelect.val(),frequency:nodes.filter.frequency.value,quality:nodes.filter.Q.value,gain:nodes.filter.gain.value},delay:{delayTime:nodes.delay.delayTime.value,feedback:nodes.feedback.gain.value}};var c=JSON.parse(localStorage.userPresets);c.presets.push(b);localStorage.userPresets=JSON.stringify(c);loadPresets();presetSelect.val(presets.length-1);}});waveSelect.on("change",function(){nodes.touchOSC.type=waveSelect.val();});oscDetuneRange.on("input",function(){nodes.touchOSC.detune.value=oscDetuneRange.val();for(var a=0;a<keyNodes.length;a++){keyNodes[a].detune.value=oscDetuneRange.val();}oscDetuneLabel.text(oscDetuneRange.val());});filterSelect.on("change",function(){nodes.filter.type=filterSelect.val();});filterFrequencyRange.on("input",function(){var b=40;var c=context.sampleRate/2;var a=Math.log(c/b)/Math.LN2;var d=Math.pow(2,a*(filterFrequencyRange.val()-1));nodes.filter.frequency.value=c*d;filterFrequencyLabel.text(nodes.filter.frequency.value.toFixed(2)+"Hz");});filterQualityRange.on("input",function(){nodes.filter.Q.value=filterQualityRange.val()*30;filterQualityLabel.text(nodes.filter.Q.value.toFixed(2));});filterGainRange.on("input",function(){nodes.filter.gain.value=filterGainRange.val();filterGainLabel.text(""+nodes.filter.gain.value);});delayTimeRange.on("input",function(){var a=1;nodes.delay.delayTime.value=delayTimeRange.val()*a/100;delayTimeLabel.text(Math.round(nodes.delay.delayTime.value*1000)+"ms");});delayFeedbackRange.on("input",function(){var a=parseInt(delayFeedbackRange.val(),10)/parseInt(delayFeedbackRange.first.max,10);nodes.feedback.gain.value=a*a;delayFeedbackLabel.text(""+Math.round(nodes.feedback.gain.value*100));});$$("#spectrumColor1, #spectrumColor2").on("change",function(){paper.gradient(0,0,util.docWidth,0,spectrumColor1.val(),spectrumColor2.val());});spectrumSize.on("change",function(){nodes.analyser.fftSize=spectrumSize.val();});$$.visibility({onHidden:function(){nodes.volume.gain.value=0;},onVisible:function(){nodes.volume.gain.value=1;}});window.screen.lockOrientation=window.screen.lockOrientation||window.screen.mozLockOrientation;if(window.screen.lockOrientation){window.screen.lockOrientation("landscape");}$$("#fullscreenBtn").on("click",function(){$$(document.documentElement).toggleFullscreen();});
